#! /usr/bin/env /bin/bash

# server=135.181.31.189:8000
server=127.0.0.1:8000
odir=results/rtt

alg=${1:-fcfs}

declare -a arr=(
    
    "500us;300us;100;5;1"
    "500us;300us;1000;5;2"
    "500us;300us;5000;5;4"
    "500us;300us;10000;5;4"
    "500us;300us;20000;5;8"
    "500us;300us;50000;5;8"

    "500us;300us;100;15;1"
    "500us;300us;1000;15;2"
    "500us;300us;5000;15;4"
    "500us;300us;10000;15;4"
    "500us;300us;20000;15;8"
    "500us;300us;50000;15;8"

    "500us;300us;100;30;1"
    "500us;300us;1000;30;2"
    "500us;300us;5000;30;4"
    "500us;300us;10000;30;4"
    "500us;300us;20000;30;8"
    "500us;300us;50000;30;8"

    "500us;300us;100;50;1"
    "500us;300us;1000;50;2"
    "500us;300us;5000;50;4"
    "500us;300us;10000;50;4"
    "500us;300us;20000;50;8"
    "500us;300us;50000;50;8"
   
    "500us;500us;100;5;1"
    "500us;500us;1000;5;2"
    "500us;500us;5000;5;4"
    "500us;500us;10000;5;4"
    "500us;500us;20000;5;8"
    "500us;500us;50000;5;8"

    "500us;500us;100;15;1"
    "500us;500us;1000;15;2"
    "500us;500us;5000;15;4"
    "500us;500us;10000;15;4"
    "500us;500us;20000;15;8"
    "500us;500us;50000;15;8"

    "500us;500us;100;30;1"
    "500us;500us;1000;30;2"
    "500us;500us;5000;30;4"
    "500us;500us;10000;30;4"
    "500us;500us;20000;30;8"
    "500us;500us;50000;30;8"

    "500us;500us;100;50;1"
    "500us;500us;1000;50;2"
    "500us;500us;5000;50;4"
    "500us;500us;10000;50;4"
    "500us;500us;20000;50;8"
    "500us;500us;50000;50;8"

    "500us;700us;100;5;1"
    "500us;700us;1000;5;2"
    "500us;700us;5000;5;4"
    "500us;700us;10000;5;4"
    "500us;700us;20000;5;8"
    "500us;700us;50000;5;8"

    "500us;700us;100;15;1"
    "500us;700us;1000;15;2"
    "500us;700us;5000;15;4"
    "500us;700us;10000;15;4"
    "500us;700us;20000;15;8"
    "500us;700us;50000;15;8"

    "500us;700us;100;30;1"
    "500us;700us;1000;30;2"
    "500us;700us;5000;30;4"
    "500us;700us;10000;30;4"
    "500us;700us;20000;30;8"
    "500us;700us;50000;30;8"

    "500us;700us;100;50;1"
    "500us;700us;1000;50;2"
    "500us;700us;5000;50;4"
    "500us;700us;10000;50;4"
    "500us;700us;20000;50;8"
    "500us;700us;50000;50;8"

)

mkdir -p $odir 
for i in "${arr[@]}"
do
   IFS=';' read -r faint slint n slowpercent conc <<<"$(echo "$i")"
   echo $faint $slint $n $slowpercent $conc

   build/client \
    --server-addr=$server \
    --slow-request-percent=$slowpercent \
    --slow-request-interval=$slint \
    --fast-request-interval=$faint \
    --concurrency=$conc \
    --n-request=$n \
    --write="${odir}/${alg}_${faint}_${slint}_${n}_${slowpercent}_${conc}"
done